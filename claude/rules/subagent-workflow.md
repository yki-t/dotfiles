# サブエージェント利用時のワークフロー

## 適用条件

このワークフローは `prohibitions.md` の「承認を得ずに実行することは禁止」の例外として扱う。
コード編集を行うサブエージェントを使用する場合、このワークフローに従ってください。

## ワークフロー

### 1. 事前準備

サブエージェントをspawnする前に、編集対象ファイルを git add してください。

```bash
git add <編集対象ファイル1> <編集対象ファイル2> ...
```

**禁止**: `git add .` や `git add -A` は使用しないでください。ファイルを明示的に指定してください。

### 2. サブエージェント実行

サブエージェントに編集タスクを委譲します。複数のサブエージェントを並列実行しても構いません。

### 3. Subagents-checker による検証

全サブエージェント完了後、`subagents-checker` エージェントに編集要件を渡してください。

```
subagents-checker に渡すプロンプト例：

## 編集要件
- <要件1>
- <要件2>
```

なお、`git diff` は `subagents-checker` が自分で実行するため、メインエージェントが実行する必要はありません。

### 4. Subagents-checker の出力確認
検証の結果以下の出力が得られます。

- **PASS**: 編集要件が満たされています。STEP5へ進んでください。
- **FAIL**, **PARTIAL**: 編集要件が満たされていません。再度サブエージェントに修正を依頼してください。つまり、STEP2,3,4を繰り返します。

すべてPASSしたらSTEP5へ進んでください。

### 5. Code-reviewer によるレビュー

変更全体を `code-reviewer` でレビューしてください。

- **Critical**: 修正対象
- **Important**: 修正対象
- **Suggestion**: ユーザーに方針確認

**Critical / Important がある場合、再度サブエージェントに修正を依頼してください。**
つまり、STEP2,3,4,5を繰り返します。

### 6. 後処理
これで、以下が担保されました。
- [ ] ユーザーの編集要件がPASSしていること (STEP3)
- [ ] レビューが完了していること (STEP5)
- [ ] レビューでCritical, Important issueが無いこと (STEP5)

Suggestionがある場合ユーザーに報告してください。
Suggestionが無い場合、ユーザーにレビュー依頼してください。

## 注意事項

- このワークフローは編集系サブエージェントにのみ適用されます（調査・レビュー系は対象外）
